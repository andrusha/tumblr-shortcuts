(function(){var h,k,i,j,l,b,g=function(a,c){return function(){return a.apply(c,arguments)}};h=function(a){return document.getElementById(a)};k=function(a,c){var e;return null!=(e=a.className)?e.match(RegExp("\\b"+c+"\\b","im")):void 0};l=function(a,c){return k(a,c)?a.className=a.className.replace(c,""):a.className+=c};j=function(){this._interceptor=g(this._interceptor,this);var a,c;this._mapping={};this._lookup={enter:13,escape:27,up:38,left:37,right:39,down:40};for(a=c=1;12>=c;a=++c)this._lookup["f"+
a]=111+a;window.addEventListener("keydown",this._interceptor)};j.prototype.add=function(a,c){var e,b,f;if(null==c){f=[];for(b in a)e=a[b],f.push(this._add(b,e));return f}return this._add(a,c)};j.prototype._add=function(a,c){var e,b,f;b=a.match(/((ctrl|alt|meta|shift)\+)?([a-z0-9]+)(:input)?/i);f=b[2];e=b[3];b=b[4];e=1===e.length?e.toUpperCase().charCodeAt(0):this._lookup[e];f=this._serialize_mod({altKey:"alt"===f,ctrlKey:"ctrl"===f,shiftKey:"shift"===f,metaKey:"meta"===f});null==this._mapping[e]&&
(this._mapping[e]={});return this._mapping[e][f]={input:null!=b,event:c}};j.prototype._is_input=function(a){return a instanceof HTMLTextAreaElement||a instanceof HTMLInputElement};j.prototype._serialize_mod=function(a){return 1*a.altKey+2*a.ctrlKey+4*a.metaKey+8*a.shiftKey};j.prototype._interceptor=function(a){var c,e;null==a&&(a=window.event);e=this._mapping[a.charCode||a.keyCode];c=this._serialize_mod(a);if(null!=e&&null!=e[c]&&this._is_input(a.target)===e[c].input)return e[c].event(a)};var d=function(){this.curPost=
g(this.curPost,this);this.prevPost=g(this.prevPost,this);this.nextPost=g(this.nextPost,this);this.prevPage=g(this.prevPage,this);this.nextPage=g(this.nextPage,this);this.changeBlog=g(this.changeBlog,this);this.queuePost=g(this.queuePost,this);this.cancelReblog=g(this.cancelReblog,this);this.confirmReblog=g(this.confirmReblog,this);this.sendReply=g(this.sendReply,this);this.view=g(this.view,this);this.page=g(this.page,this);this.reblog=g(this.reblog,this)};d.prototype._clickElement=function(a,c,e){var b,
f;null==c&&(c=!1);null==e&&(e=!1);if(null!=a)return f=!1,c&&-1!==window.navigator.appVersion.indexOf("Mac OS")&&(f=!0,c=!1),b=document.createEvent("MouseEvents"),b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,c,e,!1,f,0,null),a.dispatchEvent(b)};d.prototype._pressKey=function(a){var c;c=document.createEvent("KeyboardEvent");c.initKeyboardEvent("keydown",!0,!0,null,a.charCodeAt(0),!1,!1,!1,0);return document.dispatchEvent(c)};d.prototype._changeSelected=function(a,c){var b;if(null!=a)return a.selectedIndex=
c,b=document.createEvent("Event"),b.initEvent("change",!0,!1),a.dispatchEvent(b)};d.prototype._getReblogLink=function(a){var c,b,d,f;c=h(a).getElementsByClassName("post_controls")[0].getElementsByTagName("a");b=0;for(d=c.length;b<d;b++)if(a=c[b],null!=(f=a.href)&&f.match("reblog"))return a};d.prototype.reblog=function(a,c){null==c&&(c=!1);return this._clickElement(this._getReblogLink(a),!1,c)};d.prototype.page=function(a){a=this._getReblogLink(a);a=decodeURIComponent(a.href.match(/redirect_to=.*/)[0].substring(12));
return window.location.replace(a)};d.prototype.view=function(a){a="permalink_"+a.substring(5);return this._clickElement(h(a),!0)};d.prototype.sendReply=function(a){a="reply_button_"+a.id.substring(12);return this._clickElement(h(a))};d.prototype.confirmReblog=function(){return this._clickElement(h("save_button"))};d.prototype.cancelReblog=function(){return this._clickElement(h("cancel_button"))};d.prototype.queuePost=function(){return this._changeSelected(h("post_state"),1)};d.prototype.changeBlog=
function(){var a;a=h("channel_id");return this._changeSelected(a,a.selectedIndex<a.length-1?a.selectedIndex+1:0)};d.prototype.nextPage=function(){return this._clickElement(h("next_page_link"))};d.prototype.prevPage=function(){return this._clickElement(h("previous_page_link"))};d.prototype.nextPost=function(){return this._pressKey("J")};d.prototype.prevPost=function(){return this._pressKey("K")};d.prototype.curPost=function(){var a,c,b,d,f;c=document.body.scrollTop+7;b=h("posts").childNodes;d=0;for(f=
b.length;d<f;d++)if(a=b[d],k(a,"post")&&c>=a.offsetTop&&c<=a.offsetTop+a.offsetHeight)return a.id};i=function(){this._injectButton=g(this._injectButton,this);this._injectPopup=g(this._injectPopup,this);this.toggle=g(this.toggle,this);var a=this;this.injected=!1;window.addEventListener("DOMContentLoaded",function(){return a.inject()})};i.prototype.inject=function(){if(!this.injected)return this.injected=!0,this._injectPopup(),this._injectButton()};i.prototype.toggle=function(a){null!=a&&a.preventDefault();
this.inject();return l(h("tumblr_shortcuts_help"),"hidden")};i.prototype._injectPopup=function(){var a;a=document.createElement("div");a.setAttribute("id","tumblr_shortcuts_help");a.setAttribute("class","hidden");a.innerHTML='<div id="tumblr_shortcuts_curtain"></div>\n<div id="tumblr_shortcuts_popup">\n    <h1>Shortcuts</h1>\n\n    <h2>Dashboard</h2>\n    <p>\n        <table>\n        <tbody>\n            <tr>\n                <td>j</td><td>next post</td>\n            </tr>\n            <tr>\n                <td>k</td><td>previous post</td>\n            </tr>\n            <tr>\n                <td>l</td><td>like</td>\n            </tr>\n            <tr>\n                <td>r</td><td>open reblog page</td>\n            </tr>\n            <tr>\n                <td>alt&nbsp;+&nbsp;r</td><td>reblog without opening a page(ajax)</td>\n            </tr>\n            <tr>\n                <td>v</td><td>view post in a new tab (without loosing afocus)</td>\n            </tr>\n            <tr>\n                <td>p</td><td>open current page</td>\n            </tr>\n            <tr>\n                <td>ctrl&nbsp;+&nbsp;enter</td><td>(while writing a reply) send reply</td>\n            </tr>\n        </tbody>\n        </table>\n    </p>\n\n    <h2>Reblog page</h2>\n    <p>\n        <table>\n        <tbody>\n            <tr>\n                <td>ctrl&nbsp;+&nbsp;enter</td><td>confirm reblogging</td>\n            </tr>\n            <tr>\n                <td>esc</td><td>cancel</td>\n            </tr>\n            <tr>\n                <td>q</td><td>select "add to queue" instead of "publish now"</td>\n            </tr>\n            <tr>\n                <td>alt&nbsp;+&nbsp;q</td><td>place post in the queue</td>\n            </tr>\n            <tr>\n                <td>b</td><td>switch blogs</td>\n            </tr>\n            <tr>\n                <td>alt&nbsp;+&nbsp;b</td><td>switch blog & publish</td>\n            </tr>\n        </tbody>\n        </table>\n    </p>\n\n</div>';
a.addEventListener("click",this.toggle);return document.body.appendChild(a)};i.prototype._injectButton=function(){var a,b;b=document.createElement("div");b.setAttribute("class","tab iconic");a=document.createElement("a");a.setAttribute("id","tumblr_shortcuts_button");a.setAttribute("title","Shortcuts");a.appendChild(document.createTextNode("Shortcuts"));a.addEventListener("click",this.toggle);b.appendChild(a);return h("user_tools").insertBefore(b,h("preferences_button"))};b=new d;j=new j;i=new i;
j.add({f1:i.toggle});i=window.location.href.toLowerCase();-1!==i.indexOf("/dashboard")?j.add({r:function(){return b.reblog(b.curPost())},v:function(){return b.view(b.curPost())},p:function(){return b.page(b.curPost())},"alt+r":function(){return b.reblog(b.curPost(),!0)},"ctrl+enter:input":function(a){return b.sendReply(a.target)},"alt+right":b.nextPage,"alt+left":b.prevPage,"alt+up":b.prevPost,"alt+down":b.nextPost}):-1!==i.indexOf("/reblog/")&&j.add({b:b.changeBlog,"alt+b":function(){b.changeBlog();
return b.confirmReblog()},q:b.queuePost,"alt+q":function(){b.queuePost();return b.confirmReblog()},escape:b.cancelReblog,"ctrl+enter":b.confirmReblog})}).call(this);
